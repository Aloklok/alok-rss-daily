# Briefing Hub 项目文档

## 项目概述

Briefing Hub 是一个基于 React 和 TypeScript 构建的应用程序，使用 Supabase 和 FreshRSS 作为后端服务。它提供了一个简洁的界面来浏览每日简报、文章分类和标签管理等功能。

## 开发命令

- `npm run dev` - 启动开发服务器
- `npm run build` - 构建生产版本
- `npm run lint` - 运行 ESLint 检查
- `npm run preview` - 预览构建版本

## 环境变量

- `VITE_SUPABASE_URL` - Supabase 项目 URL
- `VITE_SUPABASE_ANON_KEY` - Supabase 匿名密钥
- `SUPABASE_URL` - Supabase 项目 URL (用于 Vercel Serverless Functions)
- `SUPABASE_SERVICE_ROLE_KEY` - Supabase 服务角色密钥 (用于 Vercel Serverless Functions)
- `FRESHRSS_API_URL` - FreshRSS API 基础 URL (用于 Vercel Serverless Functions)
- `FRESHRSS_AUTH_TOKEN` - FreshRSS 认证令牌 (用于 Vercel Serverless Functions)

## 前端架构

项目采用现代 React 架构，通过自定义 Hooks 将业务逻辑与 UI 组件分离，实现了高度的模块化和可维护性。

### 核心目录结构
- **`components/`**: 存放所有 UI 组件。复杂的组件（如 `Briefing` 和 `Sidebar`）已拆分为更小的、可复用的子组件（如 `ArticleCard`, `ArticleGroup`）。
- **`hooks/`**: 存放自定义 React Hooks，用于封装和管理应用的状态和副作用。这是应用逻辑的核心。
- **`services/`**: 存放与外部 API 通信的服务模块。

### 自定义 Hooks (逻辑层)
- **`useFilters`**: 管理所有与筛选器（日期、分类、标签）相关的状态和逻辑。
- **`useDataFetching`**: 负责根据当前筛选器获取简报和文章数据，并管理加载状态。
- **`useArticleManagement`**: 封装文章状态（已读、收藏、标签）的更新逻辑。
- **`useReader`**: 管理阅读器视图（Reader View）的显示状态和内容加载。
- **`useSidebar`**: 管理侧边栏的内部状态，如标签页切换和收藏夹的加载。

### 主要组件 (UI 层)
- **`App.tsx`**: 主应用组件，非常轻量。其主要职责是组合自定义 Hooks 并渲染应用的整体布局。
- **`Sidebar.tsx`**: 侧边栏组件，使用 `useSidebar` Hook 管理其内部状态。
- **`Briefing.tsx`**: 简报主视图，通过 `ArticleGroup` 和 `ArticleCard` 动态渲染内容。
- **`ArticleCard.tsx`**: 独立的可复用组件，用于显示单篇文章的详细信息。
- **`ArticleGroup.tsx`**: 用于显示一个文章分组（如“重要新闻”）。

## API 服务 (`services/api.ts`)

所有对后端 API 的请求都通过一个统一的服务模块进行处理。

- **集中式请求处理器**: 一个内部的 `apiService` 对象处理所有的 `fetch` 调用，统一了 URL 构建、请求头和错误处理。
- **统一的用户通知**: 服务层集成了 `showToast` 工具，可以在 API 请求成功（如更新标签）或失败时，向用户显示美观的 Toast 通知。
- **性能缓存**: `getCleanArticleContent` 函数内置了内存缓存，避免了在同一会话中对同一篇文章的重复网络请求。

## 后端 API (Vercel Serverless Functions)

后端 API 位于 `api/` 目录下，作为 Vercel Serverless Functions 部署。所有 API 端点都使用共享的 `api/_utils.ts` 模块来统一处理客户端初始化、请求处理、CORS 和错误响应。

- **`api/_utils.ts`**: 包含 `getSupabaseClient` 和 `getFreshRssClient` 用于统一初始化客户端，以及 `apiHandler` 高阶函数来封装 API 逻辑。
- **模块导入**: 在 Vercel Serverless Functions 中，模块导入路径已修正为包含 `.js` 扩展名（例如 `import ... from './_utils.js';`），以确保在 Node.js 运行时环境中正确解析。

## 关键数据流

1.  应用启动时，`useFilters` Hook 获取初始的可用日期和筛选器。
2.  `useDataFetching` Hook 监听 `activeFilter` 的变化，并自动获取对应的简报或文章列表。
3.  用户在 UI 上的操作（如点击筛选器、更新文章状态）会调用对应 Hook 中的函数 (`handleFilterChange`, `handleArticleStateChange`)。
4.  Hook 内部的逻辑会调用 `services/api.ts` 中的函数与后端通信。
5.  API 请求完成后，Hook 更新其状态，触发 UI 的重新渲染。