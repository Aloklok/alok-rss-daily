# Briefing Hub 项目文档

## 项目概述

Briefing Hub 是一个基于 React 和 TypeScript 构建的应用程序，使用 Supabase 和 FreshRSS 作为后端服务。它提供了一个简洁的界面来浏览每日简报、文章分类和标签管理等功能。

## 开发命令

- `npm run dev` - 启动开发服务器
- `npm run build` - 构建生产版本
- `npm run lint` - 运行 ESLint 检查
- `npm run preview` - 预览构建版本

## 环境变量

- `VITE_SUPABASE_URL` - Supabase 项目 URL
- `VITE_SUPABASE_ANON_KEY` - Supabase 匿名密钥

## 前端架构

### 组件结构

- `App.tsx` - 主应用组件，负责状态管理和主要逻辑
- `ArticleDetail.tsx` - 文章详情页组件
- `ReaderView.tsx` - 阅读器视图组件
- `Sidebar.tsx` - 侧边栏组件
- `ArticleCard.tsx` - 文章卡片组件

### API 调用

#### 文章内容获取

- `getCleanArticleContent` 函数通过 `/api/articles` 端点获取文章内容
- 该函数在 `App.tsx` 的 `handleOpenReader` 和 `ArticleDetail.tsx` 中被调用

#### 文章状态管理

- `getArticleStates` 函数通过 `/api/article-states` 端点获取文章状态
- `editArticleState` 函数通过 `/api/update-state` 端点更新文章状态
- `editArticleTag` 函数通过 `/api/update-state` 端点更新文章标签
- 这些函数在 `App.tsx` 的 `fetchData` 和 `handleArticleStateChange` 中被调用

#### 分类和标签

- `getArticlesByLabel` 函数通过 `/api/articles-categories-tags` 端点获取特定分类或标签的文章
- `getAvailableFilters` 函数通过 `/api/list-categories-tags` 端点获取可用的分类和标签

## 后端架构

### API 路由

- `/api/get-available-dates` - 获取可用日期列表
- `/api/get-briefings` - 获取简报报告
- `/api/articles` - 获取文章内容
- `/api/article-states` - 获取文章状态
- `/api/update-state` - 更新文章状态和标签
- `/api/articles-categories-tags` - 根据分类或标签获取文章
- `/api/starred` - 获取已收藏文章
- `/api/list-categories-tags` - 获取可用分类和标签

## 关键数据流

1. 应用启动时，通过 `getAvailableDates` 和 `getAvailableFilters` 获取初始数据
2. 用户选择日期或过滤器时，通过 `getBriefingReportsByDate` 或 `getArticlesByLabel` 获取文章数据
3. 文章状态（已读、已收藏）通过 `getArticleStates` 获取并更新
4. 用户操作文章状态时，通过 `editArticleState` 和 `editArticleTag` 更新后端

## 时区处理

应用使用上海时区（Asia/Shanghai）进行日期计算和时间显示。

## FreshRSS Google Reader API 集成

应用通过 FreshRSS 的 Google Reader API 兼容接口与后端交互，包括文章获取、状态更新和标签管理。

## 常见模式

### 文章分组

文章根据重要性（重要新闻、必知要闻、常规更新）进行分组显示。

### 标签管理

- 状态标签（如已读、已收藏）和标签（自定义标签）统一使用 `/api/update-state` API 进行管理
- 标签格式转换：从应用内部格式转换为 FreshRSS 格式

### 文章 ID 格式

文章 ID 来自 FreshRSS，格式为 `feed/<feed_id>/item/<item_id>`

## 部署

应用部署在 Vercel 上，使用服务器端函数处理 API 请求。

## TypeScript 配置

项目使用 TypeScript 进行类型安全检查，定义了详细的类型接口。

## 样式

使用 Tailwind CSS 进行样式设计，包含自定义颜色方案和响应式设计。

## 优化建议

1. **API 调用优化**
   - 当前在 `fetchData` 函数中，对于日期筛选，会先获取所有文章再获取状态；可以考虑优化为批量获取状态
   - 在 `handleArticleStateChange` 中，状态更新后需要重新获取状态，可以考虑本地缓存优化

2. **性能优化**
   - 在 `ArticleDetail.tsx` 中，文章内容获取后没有做缓存处理，可以考虑增加缓存机制
   - 大量文章渲染时可以考虑虚拟滚动优化

3. **用户体验优化**
   - 当前的标签更新提示仅在浏览器中显示，可以考虑集成更完善的 Toast 通知系统
   - 在文章状态更新失败时，可以提供更友好的错误提示

4. **代码结构优化**
   - 可以将 API 调用封装为独立的服务模块，提高代码复用性
   - 将状态管理逻辑进一步抽象，减少组件中的复杂度
   - **详细重构方案请参考 docs/api-service-refactor.md 文件**

5. **错误处理优化**
   - 当前的错误处理较为简单，可以增加更详细的错误日志记录和用户反馈

6. **可维护性提升**
   - 可以引入更完善的测试框架，确保代码质量
   - 增加更多的注释和文档说明

7. **安全性增强**
   - 对于敏感的 API 调用，可以增加身份验证和授权机制

8. **国际化支持**
   - 目前所有文本都是中文，可以考虑增加国际化支持

9. **可访问性**
   - 可以增加键盘导航支持和屏幕阅读器兼容性

10. **缓存策略**
    - 可以实现更智能的缓存策略，减少重复请求
    - 对于不经常变化的数据，可以设置更长的缓存时间